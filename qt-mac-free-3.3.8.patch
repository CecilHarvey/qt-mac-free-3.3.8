diff -rupN qt-mac-free-3.3.8/configure qt-mac-free-3.3.8_mac10.7/configure
--- qt-mac-free-3.3.8/configure	2007-01-15 13:41:50.000000000 +0100
+++ qt-mac-free-3.3.8_mac10.7/configure	2012-07-05 19:13:49.000000000 +0200
@@ -1697,7 +1697,7 @@ if [ "$CFG_CUPS" != "no" ]; then
 fi
 
 #mac
-QT_MAC_VERSION=
+QT_MAC_VERSION=0x1040
 if [ "$PLATFORM_MAC" = "yes" ]; then
     mactests=$relpath/config.tests/mac
     QT_MAC_VERSION=`$mactests/mac_version.test "$OPT_VERBOSE" "$relpath" "$outpath"`
@@ -1705,6 +1705,7 @@ if [ "$PLATFORM_MAC" = "yes" ]; then
 	CFG_TABLET=yes
     fi
 fi
+QT_MAC_VERSION=0x1040
 
 # x11
 if [ "$PLATFORM_X11" = "yes" ]; then
diff -rupN qt-mac-free-3.3.8/include/qglobal.h qt-mac-free-3.3.8_mac10.7/include/qglobal.h
--- qt-mac-free-3.3.8/include/qglobal.h	2007-02-02 15:01:04.000000000 +0100
+++ qt-mac-free-3.3.8_mac10.7/include/qglobal.h	2012-07-05 19:47:35.000000000 +0200
@@ -184,7 +184,7 @@
 #       define MAC_OS_X_VERSION_10_4 MAC_OS_X_VERSION_10_3 + 1
 #  endif
 #  if (MAC_OS_X_VERSION_MAX_ALLOWED > MAC_OS_X_VERSION_10_4)
-#    error "This version of Mac OS X is unsupported"
+//#    error "This version of Mac OS X is unsupported"
 #  endif
 #endif
 
diff -rupN qt-mac-free-3.3.8/include/qt_mac.h qt-mac-free-3.3.8_mac10.7/include/qt_mac.h
--- qt-mac-free-3.3.8/include/qt_mac.h	2007-02-02 15:01:13.000000000 +0100
+++ qt-mac-free-3.3.8_mac10.7/include/qt_mac.h	2012-07-05 19:34:28.000000000 +0200
@@ -54,7 +54,7 @@
 # define QMAC_DEFAULT_STYLE "QMacStyle" //DefaultStyle
 #endif
 
-#if !defined(Q_WS_MACX) || QT_MACOSX_VERSION < 0x1020 || QT_MACOSX_VERSION >= 0x1030
+#if !defined(Q_WS_MACX) || QT_MACOSX_VERSION < 0x1020 || QT_MACOSX_VERSION == 0x1030
 # define QMAC_NO_FAKECURSOR
 #endif
 
diff -rupN qt-mac-free-3.3.8/mkspecs/macx-g++/qmake.conf qt-mac-free-3.3.8_mac10.7/mkspecs/macx-g++/qmake.conf
--- qt-mac-free-3.3.8/mkspecs/macx-g++/qmake.conf	2007-02-02 15:01:44.000000000 +0100
+++ qt-mac-free-3.3.8_mac10.7/mkspecs/macx-g++/qmake.conf	2012-07-05 19:13:27.000000000 +0200
@@ -9,7 +9,7 @@ TEMPLATE		= app
 CONFIG			+= qt warn_on release resource_fork incremental global_init_link_order lib_version_first plugin_no_soname link_prl
 QMAKE_INCREMENTAL_STYLE = sublibs
 
-QMAKE_CC		= cc
+QMAKE_CC		= gcc
 QMAKE_LEX		= flex
 QMAKE_LEXFLAGS		= 
 QMAKE_YACC		= yacc
@@ -18,7 +18,7 @@ QMAKE_YACCFLAGS_MANGLE  = -p $base -b $b
 QMAKE_YACC_HEADER       = $base.tab.h
 QMAKE_YACC_SOURCE       = $base.tab.c
 QMAKE_RESOURCE		= /Developer/Tools/Rez
-QMAKE_CFLAGS		= -pipe
+QMAKE_CFLAGS		= -pipe -arch i386 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.6.sdk/
 QMAKE_CFLAGS_DEPS	= -M
 QMAKE_CFLAGS_WARN_ON	= -Wall -W
 QMAKE_CFLAGS_WARN_OFF	= -w
@@ -28,7 +28,7 @@ QMAKE_CFLAGS_SHLIB	= -fPIC
 QMAKE_EXTENSION_SHLIB	= dylib
 QMAKE_CFLAGS_YACC	= -Wno-unused -Wno-parentheses
 
-QMAKE_CXX		= c++
+QMAKE_CXX		= g++
 QMAKE_CXXFLAGS		= $$QMAKE_CFLAGS
 QMAKE_CXXFLAGS_DEPS	= $$QMAKE_CFLAGS_DEPS
 QMAKE_CXXFLAGS_WARN_ON	= $$QMAKE_CFLAGS_WARN_ON
@@ -46,7 +46,7 @@ QMAKE_INCDIR_OPENGL	= /System/Library/Fr
 
 QMAKE_LINK		= $$QMAKE_CXX
 QMAKE_LINK_SHLIB	= $$QMAKE_CXX
-QMAKE_LFLAGS		= -headerpad_max_install_names
+QMAKE_LFLAGS		= -headerpad_max_install_names -arch i386 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.6.sdk/
 #QMAKE_LFLAGS_PREBIND    = -seg1addr 0x90000000
 QMAKE_LFLAGS_RELEASE	=
 QMAKE_LFLAGS_DEBUG	=
diff -rupN qt-mac-free-3.3.8/src/kernel/qcursor_mac.cpp qt-mac-free-3.3.8_mac10.7/src/kernel/qcursor_mac.cpp
--- qt-mac-free-3.3.8/src/kernel/qcursor_mac.cpp	2007-02-02 15:01:16.000000000 +0100
+++ qt-mac-free-3.3.8_mac10.7/src/kernel/qcursor_mac.cpp	2012-07-05 19:16:03.000000000 +0200
@@ -177,7 +177,7 @@ struct QCursorData : public QShared
 #ifdef QMAC_USE_BIG_CURSOR_API
 	char *big_cursor_name;
 #endif
-	CursorImageRec *ci;
+	struct CursorImageRec *ci;
 	struct {
 	    QMacAnimateCursor *anim;
 	    ThemeCursor curs;
diff -rupN qt-mac-free-3.3.8/src/kernel/qt_mac.h qt-mac-free-3.3.8_mac10.7/src/kernel/qt_mac.h
--- qt-mac-free-3.3.8/src/kernel/qt_mac.h	2007-02-02 15:01:13.000000000 +0100
+++ qt-mac-free-3.3.8_mac10.7/src/kernel/qt_mac.h	2012-07-05 19:34:28.000000000 +0200
@@ -54,7 +54,7 @@
 # define QMAC_DEFAULT_STYLE "QMacStyle" //DefaultStyle
 #endif
 
-#if !defined(Q_WS_MACX) || QT_MACOSX_VERSION < 0x1020 || QT_MACOSX_VERSION >= 0x1030
+#if !defined(Q_WS_MACX) || QT_MACOSX_VERSION < 0x1020 || QT_MACOSX_VERSION == 0x1030
 # define QMAC_NO_FAKECURSOR
 #endif
 
diff -rupN qt-mac-free-3.3.8/src/network/qdns.cpp qt-mac-free-3.3.8_mac10.7/src/network/qdns.cpp
--- qt-mac-free-3.3.8/src/network/qdns.cpp	2007-02-02 15:01:09.000000000 +0100
+++ qt-mac-free-3.3.8_mac10.7/src/network/qdns.cpp	2012-07-05 19:36:52.000000000 +0200
@@ -76,7 +76,9 @@
 #include "qcleanuphandler.h"
 #include <limits.h>
 #ifdef Q_OS_MAC
-#include "../3rdparty/dlcompat/dlfcn.h"
+//#include "../3rdparty/dlcompat/dlfcn.h"
+#include <dlfcn.h>
+#define DL_PREFIX(x) x
 #endif
 
 //#define QDNS_DEBUG
diff -rupN qt-mac-free-3.3.8/src/tools/qglobal.h qt-mac-free-3.3.8_mac10.7/src/tools/qglobal.h
--- qt-mac-free-3.3.8/src/tools/qglobal.h	2007-02-02 15:01:04.000000000 +0100
+++ qt-mac-free-3.3.8_mac10.7/src/tools/qglobal.h	2012-07-05 19:47:35.000000000 +0200
@@ -184,7 +184,7 @@
 #       define MAC_OS_X_VERSION_10_4 MAC_OS_X_VERSION_10_3 + 1
 #  endif
 #  if (MAC_OS_X_VERSION_MAX_ALLOWED > MAC_OS_X_VERSION_10_4)
-#    error "This version of Mac OS X is unsupported"
+//#    error "This version of Mac OS X is unsupported"
 #  endif
 #endif
 
diff -rupN qt-mac-free-3.3.8/src/tools/qt_tools.pri qt-mac-free-3.3.8_mac10.7/src/tools/qt_tools.pri
--- qt-mac-free-3.3.8/src/tools/qt_tools.pri	2004-04-01 12:20:06.000000000 +0200
+++ qt-mac-free-3.3.8_mac10.7/src/tools/qt_tools.pri	2012-07-05 19:37:44.000000000 +0200
@@ -102,8 +102,8 @@ tools {
 
         mac:!x11:!embedded:SOURCES += $$TOOLS_CPP/qsettings_mac.cpp
 	mac {
-		SOURCES+=3rdparty/dlcompat/dlfcn.c
-		INCLUDEPATH+=3rdparty/dlcompat
+#		SOURCES+=3rdparty/dlcompat/dlfcn.c
+#		INCLUDEPATH+=3rdparty/dlcompat
 	    }
 	unix:SOURCES += $$TOOLS_CPP/qlibrary_unix.cpp
 
